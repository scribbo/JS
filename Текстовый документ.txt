Я разобралась в Вашем коде, но идей как можно написать это самостоятельно у меня нет.